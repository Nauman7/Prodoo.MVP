/*
 * File: app/view/UserResumeView.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('ProDooMobileApp.view.UserResumeView', {
    extend: 'Ext.Container',
    alias: 'widget.UserResumeView',

    requires: [
        'Ext.dataview.DataView',
        'Ext.XTemplate',
        'Ext.Button'
    ],

    config: {
        cls: 'darkBlue',
        items: [
            {
                xtype: 'dataview',
                cls: 'resumeDetail',
                height: '100%',
                itemId: 'UserResume',
                itemTpl: [
                    '<tpl if="IsAvailable == false">',
                    '<div class="detailTitle busyDetail">',
                    '    <span class="tickIcon"></span>',
                    '    <span class=\'marginForIcon\'>Not Available</span>',
                    '</div>',
                    '<tpl else>',
                    ' <div class="detailTitle">',
                    '    <span class="tickIcon"></span>',
                    '<span class=\'marginForIcon\'>Available Now</span>',
                    '</div>',
                    '</tpl>',
                    '',
                    '',
                    '',
                    '<div class="LocationDiv"><span class="location">{Region}</span>',
                    '    <span class="onSite">on-site</span>',
                    '</div>',
                    '<div class="ViewCnt">',
                    '    <div class="tabHead">',
                    '        <span class="speakIcon"> </span>',
                    '        <span class="ArrowUp"> </span>',
                    '    </div>',
                    '    <div class="Innerlist">',
                    '      ',
                    '        <tpl for="Languages">',
                    '        <div class="listCnt">  ',
                    '            <span class="language">{LanguageValue}</span>',
                    '            <span class="level">Level <span class="levelNo orange2">{ExperienceLevel}</span></span>',
                    '        </div>',
                    '        </tpl>',
                    '        ',
                    '        ',
                    '       ',
                    '    </div>',
                    '</div>',
                    '<div class="ViewCnt">',
                    '    <div class="tabHead">',
                    '        <span class="userIcon"> </span>',
                    '        <span class="ArrowUp"> </span>',
                    '    </div>',
                    '    <div class="Innerlist">',
                    '        ',
                    '        <tpl for="Profiles">',
                    '        <div class="listCnt">',
                    '            <span class="language">{ProfileValue}</span>',
                    '        </div>',
                    '        </tpl>',
                    '        ',
                    '        ',
                    '        ',
                    '    </div>',
                    '</div>',
                    '',
                    '<div class="ViewCnt">',
                    '    <div class="tabHead">',
                    '        <span class="langIcon"> </span>',
                    '        <span class="ArrowUp"> </span>',
                    '    </div>',
                    '    <div class="Innerlist">',
                    '        <tpl for="Skills">',
                    '        <div class="listCnt center">',
                    '            <span class="language">{SkillValue}</span>',
                    '        </div>',
                    '            </tpl>',
                    '',
                    '    </div>',
                    '</div>',
                    '    ',
                    '<div class="ViewCnt">',
                    '    <div class="tabHead">',
                    '        <span class="KeywordIcon"> </span>',
                    '        <span class="ArrowUp"> </span>',
                    '    </div>',
                    '    <div class="Innerlist">',
                    '        <tpl for="Keywords">',
                    '        <div class="listCnt center">',
                    '            <span class="language">{KeywordValue}</span>',
                    '        </div>',
                    '            </tpl>',
                    '',
                    '    </div>',
                    '</div>',
                    '',
                    '<div class="ViewCnt">',
                    '    <div class="tabHead">',
                    '        <span class="certIcon"> </span>',
                    '        <span class="ArrowUp"> </span>',
                    '    </div>',
                    '    <div class="Innerlist">',
                    '        <tpl for="Certifications">',
                    '        <div class="listCnt">',
                    '            <span class="language">{CertificationValue}</span>',
                    '            <span class="yearExp">{CertificationDate:date("Y")}</span>',
                    '        </div>',
                    '            </tpl>',
                    '    </div>',
                    '</div>',
                    '',
                    '    ',
                    '   ',
                    '<div class="ViewCnt">',
                    '     ',
                    '    <div class="tabHead">',
                    '        <span class="caseIcon"> </span>',
                    '        <span class="ArrowUp"> </span>',
                    '    </div>',
                    '    <div class="Innerlist">',
                    '    <tpl for="ResumeExperience">',
                    '        <div class="tabHead InnerHead">',
                    '           <span class="BoardGame">{CompanyWorked}</span>',
                    '            <span class="ArrowUp"> </span>',
                    '        </div>',
                    '',
                    '',
                    '    <div class="innerListLevel2">',
                    '<!--             <div class="listCnt">',
                    '                <span class="language"></span>',
                    '                ',
                    '            </div> -->',
                    '            <div class="listCnt">',
                    '                <span class="language">{ProfileValue} ({IndustryValue})</span>',
                    '                <span class="yearExp">{StartDateYear} - {EndDateYear}</span>',
                    '              ',
                    '            </div>',
                    '            ',
                    '',
                    '            <div class="listCnt para">',
                    '                {Description}',
                    '            </div>',
                    '        </div>',
                    '        </tpl>',
                    '        ',
                    '    </div>',
                    '</div>',
                    ''
                ],
                store: 'SearchResultDetail'
            },
            {
                xtype: 'container',
                centered: true,
                cls: [
                    'labelCls',
                    'center'
                ],
                docked: 'top',
                hidden: true,
                html: 'Welcome to the Resume view<br>  tab on edit icon to create new resume',
                itemId: 'ResumeSplash'
            },
            {
                xtype: 'button',
                bottom: 10,
                cls: [
                    'btnCircle',
                    'homeIcon'
                ],
                docked: 'bottom',
                itemId: 'ResumeHomeButton',
                left: 10,
                text: ' '
            },
            {
                xtype: 'button',
                bottom: 10,
                cls: [
                    'btnCircle',
                    'resumeEdit'
                ],
                docked: 'bottom',
                itemId: 'ResumeEditBtn',
                right: 10,
                text: ' '
            }
        ],
        listeners: [
            {
                fn: 'onMydataviewItemTap',
                event: 'itemtap',
                delegate: '#UserResume'
            },
            {
                fn: 'onMybutton6Tap1',
                event: 'tap',
                delegate: '#ResumeHomeButton'
            },
            {
                fn: 'onMybutton4Tap',
                event: 'tap',
                delegate: '#ResumeEditBtn'
            }
        ]
    },

    onMydataviewItemTap: function(dataview, index, target, record, e, eOpts) {
        var selectedItem = e.target;
        if(selectedItem.className.indexOf('ArrowUp')>=0){
            Ext.get(selectedItem).toggleCls('ArrowDown');
            var detail = selectedItem.parentElement.nextElementSibling;
            var innerEl = detail.children;


            if ( !Ext.get(selectedItem).hasCls('ArrowDown')) {
                detail.removeAttribute('style');
            }
            else{
                if(detail.style.maxHeight==""){
                    detail.removeAttribute('style');
                }
                detail.style.maxHeight = '0px';
            }
        }

        // if(selectedItem.className.indexOf('SrNo')>=0){
        //     Ext.get(selectedItem).toggleCls('rightSide');
        // }
    },

    onMybutton6Tap1: function(button, e, eOpts) {
        G.showHomeView();
    },

    onMybutton4Tap: function(button, e, eOpts) {
        // showing loader not visible while rendering the view
        //Ext.Viewport.setMasked(true);
        G.Push('ResumeView');
        var store = Ext.getStore('SearchResultDetail');
        var resume = store.getAt(0).data;
        if(resume.Profiles.length > 0 ){
            var profiles = resume.Profiles;
            profiles.forEach(function(item,index){
                G.createKeywordView('Profile',item.ProfileValue,item.ProfileId,item.ExperienceLevel);
            });
            G.show('ProfileCnt');
        }
        else{
            G.show('SplashCnt');
        }

        if(resume.Skills.length > 0 ){
            var skills = resume.Skills;
            skills.forEach(function(item,index){
                G.createKeywordView('Skill',item.SkillValue,item.SkillId,item.ExperienceLevel);
            });
        }

        if(resume.Keywords.length > 0 ){
            var keywords = resume.Keywords;
            keywords.forEach(function(item,index){
                G.createKeywordView('Keyword',item.KeywordValue, item.KeywordId);
            });
        }

        if(resume.Certifications.length > 0 ){
            var certifications = resume.Certifications;
            certifications.forEach(function(item,index){
                G.createKeywordView('Certification',item.CertificationValue, item.CertificationId);
            });
        }

        var settingContainer = G.get('SettingCnt');
        var region = settingContainer.down('selectfield[name=RegionId]');
        var availblDate = settingContainer.down('selectfield[name=AvailabilityDate]');
        availblDate.setValue( new Date(resume.AvailabilityDate));
        region.setValue(resume.Region);

        var button = settingContainer.down('button');
        if(resume.IsAvailable){
            button.removeCls('busyBtn');
            var Cnt = button.up('#availabilityCnt');
            Cnt.removeCls('BusyCnt');
            Cnt.down('#availabilityLbl').setHtml('Available');
        }
        else{
            button.addCls('busyBtn');
            var Cnt = button.up('#availabilityCnt');
            Cnt.addCls('BusyCnt');
            Cnt.down('#availabilityLbl').setHtml('Not Available');
        }


        if(resume.Languages.length > 0 ){

            var Languages = resume.Languages;
            Languages.forEach(function(item,index){
                UserResume.CloneLangaugeControl(item.ExperienceLevel,item.LanguageId);

            });
        }

        var locField=G.get("locationSelectField");
        if (locField !== undefined)
        {
            var locFieldVal=locField.getValue();
            if (locFieldVal === null || locFieldVal === "") {
                locField.setValue("Denmark");
            }
        }

        var languageField=G.get("languageDropdown");
        if (languageField !== undefined)
        {
            var languageFieldVal =languageField.getValue();
            if (languageFieldVal === null || languageFieldVal === "") {
                languageField.setValue(2); // 2 is for Denish
            }
        }
        //Ext.Viewport.setMasked(false);
    }

});